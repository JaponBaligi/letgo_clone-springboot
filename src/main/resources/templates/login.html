<!DOCTYPE html>
<html lang="tr" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: html}">

<head>
    <title th:text="${title}">Giriş Yap - Takı Kazan Clone</title>
</head>

<body>
    <main th:fragment="content">
        <section class="py-5">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-4 col-md-6">
                        <div class="card shadow-sm">
                            <div class="card-body p-5">
                                <h3 class="text-center mb-4">Giriş Yap</h3>

                                <form id="loginForm">
                                    <div class="mb-3">
                                        <label class="form-label">Kullanıcı Adı</label>
                                        <input type="text" class="form-control" id="username" name="username" required>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Şifre</label>
                                        <input type="password" class="form-control" id="password" name="password"
                                            required>
                                    </div>

                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="rememberMe">
                                        <label class="form-check-label" for="rememberMe">Beni Hatırla</label>
                                    </div>

                                    <button type="submit" class="btn btn-primary w-100 mb-3">Giriş Yap</button>
                                </form>

                                <div class="text-center">
                                    <p class="mb-0">Hesabın yok mu? <a href="/register" class="text-primary">Kayıt
                                            Ol</a></p>
                                </div>

                                <hr class="my-4">

                                <div class="text-center">
                                    <h6 class="text-muted mb-3">Demo Hesap</h6>
                                    <p class="small text-muted mb-2">Kullanıcı Adı: <strong>demo</strong></p>
                                    <p class="small text-muted">Şifre: <strong>demo123</strong></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        document.getElementById('loginForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            fetch('/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`
            })
                .then(response => response.text())
                .then(data => {
                    if (data === 'success') {
                        // Show success message
                        showNotification('Giriş başarılı!', 'success');

                        // Redirect to home page after a short delay
                        setTimeout(() => {
                            window.location.href = '/';
                        }, 1000);
                    } else {
                        showNotification('Kullanıcı adı veya şifre hatalı!', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('Bir hata oluştu!', 'error');
                });
        });

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                min-width: 300px;
            `;
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
    </script>
</body>

</html>